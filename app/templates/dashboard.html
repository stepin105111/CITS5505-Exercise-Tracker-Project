{% extends "base.html" %}

{% block title %}Dashboard | Fitness Tracker{% endblock %}

{% block header %}
<!-- Empty to suppress base.html header -->
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block body_class %}dashboard-page{% endblock %}
{% block content %}
<div class="app-container">
  <aside class="sidebar">
    <div class="menu-toggle">
      <i class="fas fa-bars"></i>
    </div>
        <div class="sidebar-header">
      <div class="profile-emoji">{{ user.profile_emoji or 'üòÄ' }}</div>
      <div class="user-info">
        <h3>{{ user.username }}</h3>
        <p>Fitness Enthusiast</p>
      </div>
    </div>
    <nav class="menu">
      <a href="#" class="menu-item active" data-target="dashboard-section">
        <i class="fas fa-home"></i> <span>Dashboard</span>
      </a>
      <a href="#" class="menu-item" data-target="profile-section">
        <i class="fas fa-user"></i> <span>My Profile</span>
      </a>
      <a href="#" class="menu-item" data-target="workout-plan-section">
        <i class="fas fa-calendar-alt"></i> <span>Workout Plan</span>
      </a>
      <a href="#" class="menu-item" data-target="workout-details-section">
        <i class="fas fa-calendar-alt"></i> <span>Workout Details</span>
      </a>
      <a href="#" class="menu-item" data-target="workout-statistic-section">
        <i class="fas fa-chart-line"></i> <span>Workout Statistics</span>
      </a>
      <a href="#" class="menu-item" data-target="schedule-section">
        <i class="fas fa-calendar-week"></i> <span>My Schedule</span>
      </a>
      <a href="#" class="menu-item" data-target="share-section">
        <i class="fas fa-share-alt"></i> <span>Share Data</span>
      </a>
      <a href="#" class="menu-item settings-btn" data-target="settings-section">
        <i class="fas fa-user-circle fa-lg"></i> <span>Settings</span>
      </a>
      <form method="POST" action="{{ url_for('logout') }}">
          <button type="submit">Logout</button>
      </form>
    </nav>
  </aside>
  <main class="main-content">
    <header class="dashboard-header">
      <h1>Welcome, {{ user.username }}!</h1>
    </header>
    <section id="dashboard-section" class="content-section active">
      <div class="statistics-container">
        <div class="stats-card">
          <div class="stats-icon blue">
            <i class="fas fa-dumbbell"></i>
          </div>
          <div class="stats-info">
            <h3>Workout Days</h3>
            <p>{{ total_workout_days }} / 7</p>
          </div>
        </div>
        <div class="stats-card">
          <div class="stats-icon orange">
            <i class="fas fa-fire-alt"></i>
          </div>
          <div class="stats-info">
            <h3>Calories Burned</h3>
            <p>{{ total_calories }}</p>
          </div>
        </div>
        <div class="stats-card">
          <div class="stats-icon green">
            <i class="fas fa-running"></i>
          </div>
          <div class="stats-info">
            <h3>Distance Covered</h3>
            <p>{{ distance_km }} km</p>
          </div>
        </div>
        <div class="stats-card">
          <div class="stats-icon red">
            <i class="fas fa-stopwatch"></i>
          </div>
          <div class="stats-info">
            <h3>Workout Time</h3>
            <p>{{ (total_duration // 60) }} hr {{ (total_duration % 60) }} mins</p>
          </div>
        </div>
      </div>

      <form method="POST" action="{{ url_for('reset_stats') }}"
        onsubmit="return confirm('Are you sure you want to reset all workout stats?');">
        <button type="submit" class="btn custom-btn">Reset Stats</button>
      </form>     

      <h2>WORKOUT PLANS</h2>
      <div class="workout-plans">
        {% for plan in weekly_plans %}
        <div class="workout-plan">
          <h3>{{ plan.plan_name }}</h3>
          <p>Calories Goal: {{ plan.calorie_goal }}</p>
          <p>Time Goal: {{ plan.time_goal_minutes }} minutes</p>
          <p><strong>Duration:</strong> {{ plan.start_date }} to {{ plan.end_date }}</p>

          <div class="plan-actions">
            <form method="POST" action="{{ url_for('delete_plan', plan_id=plan.id) }}"
              onsubmit="return confirm('Are you sure you want to delete this plan?');">
              <button type="submit" class="delete-button">Delete</button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <section id="profile-section" class="content-section">
      <h2>My Profile</h2>
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-emoji">{{ user.profile_emoji or 'üòÄ' }}</div>
          <h3>{{ user.username }}</h3>
          <p>{{ user.email }}</p>
        </div>
        <form method="POST" action="{{ url_for('dashboard') }}">
          {{ form.hidden_tag() }}
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" class="form-control" value="{{ user.username }}" readonly>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" class="form-control" value="{{ user.email }}" readonly>
          </div>
          <div class="form-group">
            <label for="name">Name</label>
            {{ form.name(class="form-control", placeholder="Enter your name") }}
            {% if form.name.errors %}
              <div class="error">{{ form.name.errors[0] }}</div>
            {% endif %}
          </div>
          <div class="form-group">
            <label for="age">Age</label>
            {{ form.age(class="form-control", placeholder="Enter your age") }}
            {% if form.age.errors %}
              <div class="error">{{ form.age.errors[0] }}</div>
            {% endif %}
          </div>
          <div class="form-group">
            <label for="weight">Weight (kg)</label>
            {{ form.weight(class="form-control", placeholder="Enter your weight") }}
            {% if form.weight.errors %}
              <div class="error">{{ form.weight.errors[0] }}</div>
            {% endif %}
          </div>
          <div class="form-group">
            <label for="height">Height (cm)</label>
            {{ form.height(class="form-control", placeholder="Enter your height") }}
            {% if form.height.errors %}
              <div class="error">{{ form.height.errors[0] }}</div>
            {% endif %}
          </div>
          <div class="form-group">
            <label>Profile Emoji</label>
            <div class="emoji-selector">
              {% for value, label in form.profile_emoji.choices %}
                <label>
                  <input type="radio" name="profile_emoji" value="{{ value }}" {% if user.profile_emoji == value %}checked{% endif %}>
                  <span class="emoji">{{ label }}</span>
                </label>
              {% endfor %}
            </div>
            {% if form.profile_emoji.errors %}
              <div class="error">{{ form.profile_emoji.errors[0] }}</div>
            {% endif %}
          </div>
          <button type="submit" class="btn btn-primary">Update Profile</button>
        </form>
      </div>
    </section> 

    
    <!-- filepath: c:\Users\Naishadh\Downloads\CITS5505-Exercise-Tracker-Project-main (6)\CITS5505-Exercise-Tracker-Project-main\app\templates\dashboard.html -->

    <!-- Workout Plan Section -->
    <section id="workout-plan-section" class="content-section">
      <h2>Create Workout Plan</h2>
      <form method="POST" action="{{ url_for('create_plan') }}">
        <div class="form-group">
          <label for="plan_name">Plan Name</label>
          <input type="text" id="plan_name" name="plan_name" class="form-control" placeholder="Enter plan name" required>
        </div>
        <div class="form-group">
          <label for="calorie_goal">Calorie Goal</label>
          <input type="number" id="calorie_goal" name="calorie_goal" class="form-control" placeholder="Enter calorie goal" required>
        </div>
        <div class="form-group">
          <label for="time_goal_minutes">Time Goal (minutes)</label>
          <input type="number" id="time_goal_minutes" name="time_goal_minutes" class="form-control" placeholder="Enter time goal in minutes" required>
        </div>
        <div class="form-group">
          <label for="workout_days">Select Days</label>
          <select id="workout_days" name="workout_days" class="form-control" multiple required>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
            <option value="Saturday">Saturday</option>
            <option value="Sunday">Sunday</option>
          </select>
          <small class="form-text text-muted">Hold Ctrl (Windows) or Command (Mac) to select multiple days.</small>
        </div>
        <button type="submit" class="btn btn-primary">Create Plan</button>
      </form>
    </section>

    <!-- Schedule Section -->
    <section id="schedule-section" class="content-section">
      <h2>My Upcoming Schedule</h2>
      <div class="schedule-header">
        <h3>Weekly Workout Schedule</h3>
        <p>Track your workouts and stay on top of your fitness goals!</p>
      </div>
      {% if weekly_plans %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Plan Name</th>
              <th>Calorie Goal</th>
              <th>Time Goal (minutes)</th>
              <th>Days</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for plan in weekly_plans %}
            <tr>
              <td>{{ plan.plan_name }}</td>
              <td>{{ plan.calorie_goal }}</td>
              <td>{{ plan.time_goal_minutes }}</td>
              <td>{{ plan.workout_days }}</td>
              <td>
                <form method="POST" action="{{ url_for('delete_plan', plan_id=plan.id) }}" onsubmit="return confirm('Are you sure you want to delete this plan?');">
                  <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No workout plans created yet. Create one above!</p>
      {% endif %}
    </section>

    <section id="workout-details-section" class="content-section">
      <h2>ENTER WORKOUT DETAILS</h2>
      <form method="post" action="{{ url_for('create_workout') }}">
        <div class="plan-creator">

          <!-- Plan Name -->
          <div class="form-group">
            <label for="plan-name">Workout Name</label>
            <input type="text" id="plan-name" name="plan_name" class="form-control" placeholder="e.g., Cardio">
          </div>

          <!-- Description -->
          <div class="form-group">
            <label for="plan-description">Description</label>
            <textarea id="plan-description" name="description" class="form-control" rows="3"
              placeholder="Describe your workout "></textarea>
          </div>

          <!-- Duration -->
          <div class="form-group">
            <label for="plan-duration">Duration in minutes (weeks)</label>
            <input type="number" id="plan-duration" name="duration_minutes" class="form-control">
          </div>

          <!-- Workout Type -->
          <div class="form-group">
            <label for="workout-type">Workout Type</label>
            <select id="workout-type" name="workout_type" class="form-control" required>
              <option value="">-- Select --</option>
              <option value="Cardio">Cardio</option>
              <option value="Strength">Strength</option>
              <option value="Running">Running</option>
              <option value="Cycling">Cycling</option>
              <option value="Yoga">Yoga</option>
              <option value="Mixed">Mixed</option>
            </select>
          </div>

          <!-- Calories Goal -->
          <div class="form-group">
            <label for="calories-goal">Calories</label>
            <input type="number" id="calories-goal" name="calories" class="form-control" placeholder="e.g., 500">
          </div>

          <!-- Intensity -->
          <div class="form-group">
            <label for="intensity">Intensity</label>
            <select id="intensity" name="intensity" class="form-control">
              <option value="">-- Select Intensity --</option>
              <option value="Low">Low</option>
              <option value="Moderate">Moderate</option>
              <option value="High">High</option>
            </select>
          </div>

          <!-- Start Date -->
          <div class="form-group">
            <label for="start-date">Start Date</label>
            <input type="date" id="start-date" name="start_date" class="form-control">
          </div>

          <!-- Workout Days -->
          <div class="form-group">
            <label for="plan-days">Workout Days</label>
            <input type="text" name="workout_days" class="form-control" placeholder="e.g., Mon,Wed,Fri">
          </div>

          <!-- Submit Button -->
          <button class="btn btn-primary">Create Workout</button>
        </div>
      </form>


      <div id="workout-details-container"></div>
    </section>

    <section id="workout-statistic-section" class="content-section">
      <h2>WORKOUT STATISTICS</h2>
      <div class="chart-container">
        <!-- Pie Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Workout Activities (Pie Chart)</h3>
          </div>
          <canvas id="activitiesChart" data-labels='{{ workout_types | tojson }}'
            data-counts='{{ workout_counts | tojson }}'>
          </canvas>
        </div>

        <!-- Calories per Weekday Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Calories Burned per Weekday</h3>
          </div>
          <canvas id="weekdayChart" data-labels='{{ weekday_labels | tojson }}'
            data-values='{{ weekday_calories | tojson }}'>
          </canvas>
        </div>

        <!-- Time Spent per Weekday Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Time Spent per Weekday</h3>
          </div>
          <canvas id="timeChart" data-labels='{{ time_labels | tojson }}'
            data-values='{{ time_spent_values | tojson }}'>
          </canvas>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Weekly Progression</h3>
          </div>

          <ul class="progress-list">
            {% for plan in weekly_plans %}
            <li class="progress-item">
              <strong>{{ plan.plan_name }}</strong>
              <div class="progress-bar-wrapper">
                <div class="progress-bar" style="width: {{ progress_data[plan.plan_name] }}%;">
                  {{ progress_data[plan.plan_name] }}%
                </div>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
    </section>

    <section id="schedule-section" class="content-section">
      <h2>MY SCHEDULE</h2>
      <div class="schedule-header">
        <h3>Weekly Workout Schedule</h3>
        <p>Track your workouts and stay on top of your fitness goals!</p>
      </div>
      <div class="schedule-container">
      {% if weekly_plans %}
        {% for plan in weekly_plans %}
          <div class="schedule-card">
            <h3>{{ plan.plan_name }}</h3>
            <p><strong>Calories Goal:</strong> {{ plan.calorie_goal }}</p>
            <p><strong>Time Goal:</strong> {{ plan.time_goal_minutes }} minutes</p>
            <p><strong>Duration:</strong> {{ plan.start_date }} to {{ plan.end_date }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p>No workout plans created yet. Create one above!</p>
      {% endif %}
      </div>
    </section>


    <section id="share-section" class="content-section">
      <h2>FRIENDS & LEADERBOARD</h2>
      
      <!-- Search Friends Section -->
      <div class="search-container">
        <h3 class="section-title">Find Friends</h3>
        <input type="text" id="user-search" class="search-input" placeholder="Search by username...">
        <div id="search-results" class="search-results"></div>
      </div>
    
      <!-- Friends Leaderboard -->
      <div class="leaderboard-container">
        <h3 class="section-title">Friend Activity Leaderboard</h3>
        
        {% if friends %}
          {% for friend in friends %}
            <div class="friend-card {% if friend.rank == 1 %}top-rank{% endif %} {% if friend.is_current_user %}current-user-card{% endif %}">
              <div class="rank-badge {% if friend.is_current_user %}user-badge{% endif %}">{{ friend.rank }}</div>
              <div class="friend-name">{{ friend.username }}</div>
              
              {% if friend.activity == 'No recent activity' %}
                <p><span class="activity-icon">‚è≥</span> No workout activity recorded yet.</p>
              {% else %}
                <p>
                  {% if friend.activity == 'Strength Training' %}
                    <span class="activity-icon">üèãÔ∏è</span>
                  {% elif friend.activity == 'Running' %}
                    <span class="activity-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                  {% elif friend.activity == 'Cardio' %}
                    <span class="activity-icon">‚ù§Ô∏è</span>
                  {% elif friend.activity == 'Yoga' %}
                    <span class="activity-icon">üßò</span>
                  {% elif friend.activity == 'Swimming' %}
                    <span class="activity-icon">üèä‚Äç‚ôÇÔ∏è</span>
                  {% elif friend.activity == 'Cycling' %}
                    <span class="activity-icon">üö¥‚Äç‚ôÄÔ∏è</span>
                  {% elif friend.activity == 'Mixed' %}
                    <span class="activity-icon">üîÑ</span>
                  {% else %}
                    <span class="activity-icon">üí™</span>
                  {% endif %}
                  
                  Burned <strong>{{ friend.calories }} kcal</strong> in <strong>{{ friend.duration }} minutes</strong> 
                  doing {{ friend.activity }}.
                </p>
                
                {% if friend.shared_days_ago is not none %}
                  <p><small class="text-muted">
                    {% if friend.shared_days_ago == 0 %}
                      Shared today
                    {% elif friend.shared_days_ago == 1 %}
                      Shared yesterday
                    {% else %}
                      Shared {{ friend.shared_days_ago }} days ago
                    {% endif %}
                  </small></p>
                {% endif %}
              {% endif %}
            </div>
          {% endfor %}
        {% elif has_friends %}
          <div class="text-center p-4">
            <p>You haven't added any friends yet. Use the search above to find friends!</p>
          </div>
        {% else %}
          <div class="friend-card current-user-card">
            <div class="rank-badge user-badge">1</div>
            <div class="friend-name">{{ user.username }} (You)</div>
            
            {% if friends[0].activity == 'No recent activity' %}
              <p><span class="activity-icon">‚è≥</span> No workout activity recorded yet.</p>
            {% else %}
              <p>
                {% if friends[0].activity == 'Strength Training' %}
                  <span class="activity-icon">üèãÔ∏è</span>
                {% elif friends[0].activity == 'Running' %}
                  <span class="activity-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                {% elif friends[0].activity == 'Cardio' %}
                  <span class="activity-icon">‚ù§Ô∏è</span>
                {% elif friends[0].activity == 'Yoga' %}
                  <span class="activity-icon">üßò</span>
                {% elif friends[0].activity == 'Swimming' %}
                  <span class="activity-icon">üèä‚Äç‚ôÇÔ∏è</span>
                {% elif friends[0].activity == 'Cycling' %}
                  <span class="activity-icon">üö¥‚Äç‚ôÄÔ∏è</span>
                {% elif friends[0].activity == 'Mixed' %}
                  <span class="activity-icon">üîÑ</span>
                {% else %}
                  <span class="activity-icon">üí™</span>
                {% endif %}
                
                Burned <strong>{{ friends[0].calories }} kcal</strong> in <strong>{{ friends[0].duration }} minutes</strong> 
                doing {{ friends[0].activity }}.
              </p>
              
              {% if friends[0].shared_days_ago is not none %}
                <p><small class="text-muted">
                  {% if friends[0].shared_days_ago == 0 %}
                    Shared today
                  {% elif friends[0].shared_days_ago == 1 %}
                    Shared yesterday
                  {% else %}
                    Shared {{ friends[0].shared_days_ago }} days ago
                  {% endif %}
                </small></p>
              {% endif %}
            {% endif %}
            
            <div class="text-center mt-3">
              <p>You'll see how you compare once you add friends. Use the search above to find friends!</p>
            </div>
          </div>
        {% endif %}
      </div>
    </section>

    <!-- filepath: c:\Users\Naishadh\Downloads\CITS5505-Exercise-Tracker-Project-main (6)\CITS5505-Exercise-Tracker-Project-main\app\templates\dashboard.html -->
    <section id="settings-section" class="content-section">
      <h2>Settings</h2>
      <form method="POST" action="{{ url_for('update_settings') }}">
        <!-- Account Settings -->
        <div class="settings-group">
          <h3>Account Settings</h3>
          <div class="form-group">
            <label for="email">Update Email</label>
            <input type="email" id="email" name="email" class="form-control" value="{{ user.email }}" placeholder="Enter new email">
          </div>
          <div class="form-group">
            <label for="password">Change Password</label>
            <input type="password" id="password" name="password" class="form-control" placeholder="Enter new password">
          </div>
          <div class="form-group">
            <label for="confirm-password">Confirm Password</label>
            <input type="password" id="confirm-password" name="confirm_password" class="form-control" placeholder="Confirm new password">
          </div>
        </div>

        <!-- Save Changes Button -->
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </form>

      <!-- Delete Account Section -->
      <div class="delete-account">
        <h3>Leaving so soon ?</h3>
        <form method="POST" action="{{ url_for('delete_account') }}" onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
          <button type="submit" class="btn btn-danger">Delete Account</button>
        </form>
      </div>
    </section>

  </main>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
<script src="{{ url_for('static', filename='js/visualise.js') }}"></script>
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<script src="{{ url_for('static', filename='js/friends.js') }}"></script>

{% endblock %}
